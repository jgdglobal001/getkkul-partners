# 🏗️ 파트너스 인증 아키텍처 결정 가이드

## 🎯 두 가지 선택지

### 방식 A: 쇼핑 회원가입/로그인 재사용 (크로스 도메인)
### 방식 B: 파트너스 전용 회원가입/로그인 (독립적)

---

## 📊 상세 비교

### 방식 A: 쇼핑 재사용 (크로스 도메인)

```
파트너스 (3003)
  ↓ [회원가입 클릭]
쇼핑 (3002) - 회원가입/로그인 페이지
  ↓ [인증 완료]
파트너스 (3003) - 리다이렉트 + 세션 공유
```

#### ✅ 장점
1. **코드 중복 최소화**
   - 회원가입/로그인 UI 한 번만 관리
   - 버그 수정 한 번에 반영

2. **사용자 관리 통합**
   - 같은 User 테이블 사용
   - 사용자 정보 동기화 불필요

3. **개발 시간 단축**
   - 쇼핑 코드 복사만으로 구현
   - 테스트 간소화

4. **일관된 UX**
   - 모든 프로젝트에서 같은 인증 경험

#### ❌ 단점
1. **크로스 도메인 복잡성**
   - 쿠키 공유 설정 필요
   - CORS 설정 필요
   - 리다이렉트 URL 관리 복잡

2. **프로젝트 독립성 감소**
   - 쇼핑 변경 시 파트너스 영향
   - 쇼핑 서버 다운 → 파트너스 인증 불가

3. **OAuth 설정 복잡**
   - 각 OAuth 제공자에서 리다이렉트 URI 2개 등록
   - 개발/프로덕션 환경 관리 복잡

4. **보안 고려사항**
   - 크로스 도메인 토큰 전달 위험
   - CSRF 공격 가능성

---

### 방식 B: 파트너스 전용 (독립적)

```
파트너스 (3003)
  ├─ 회원가입 페이지 (독립적)
  ├─ 로그인 페이지 (독립적)
  └─ NextAuth 설정 (독립적)
```

#### ✅ 장점
1. **완전한 독립성**
   - 쇼핑과 완전히 분리
   - 쇼핑 변경 영향 없음
   - 쇼핑 서버 다운 → 파트너스 정상 작동

2. **간단한 OAuth 설정**
   - 각 OAuth 제공자에서 리다이렉트 URI 1개만 등록
   - 개발/프로덕션 환경 관리 단순

3. **보안 강화**
   - 크로스 도메인 통신 없음
   - 토큰 전달 위험 없음
   - 각 프로젝트 독립적 보안

4. **유연한 커스터마이징**
   - 파트너스 특화 기능 추가 가능
   - 다른 UI/UX 적용 가능
   - 다른 인증 방식 추가 가능

#### ❌ 단점
1. **코드 중복**
   - 회원가입/로그인 코드 2번 관리
   - 버그 수정 2번 필요

2. **사용자 정보 동기화**
   - 같은 User 테이블 사용하면 동기화 필요
   - 또는 별도 User 테이블 필요

3. **개발 시간 증가**
   - 쇼핑 코드 복사 + 커스터마이징
   - 테스트 2배 필요

4. **유지보수 복잡**
   - 같은 기능 2곳에서 관리
   - 버전 관리 복잡

---

## 🤔 선택 기준

### 방식 A 추천 상황
- ✅ 쇼핑과 파트너스가 **같은 회사 운영**
- ✅ 사용자가 **쇼핑과 파트너스를 함께 사용**
- ✅ **통합 사용자 관리** 필요
- ✅ 크로스 도메인 기술에 **자신 있음**

### 방식 B 추천 상황
- ✅ 쇼핑과 파트너스가 **독립적 서비스**
- ✅ 사용자가 **한 가지만 사용** (쇼핑 또는 파트너스)
- ✅ **프로젝트 독립성 중요**
- ✅ **빠른 개발** 원함
- ✅ **보안 단순화** 원함

---

## 📋 당신의 상황 분석

### 현재 상황
- 쇼핑: 완성된 인증 시스템 (Google, Kakao, Naver)
- 파트너스: 인증 미구현
- 데이터베이스: 같은 Neon PostgreSQL 공유
- 사용자: 쇼핑 사용자 ≠ 파트너스 사용자 (다른 역할)

### 질문
1. **파트너스 사용자와 쇼핑 사용자가 같은 사람인가?**
   - YES → 방식 A 추천
   - NO → 방식 B 추천

2. **파트너스는 독립적 서비스인가?**
   - YES → 방식 B 추천
   - NO → 방식 A 추천

3. **향후 파트너스 특화 기능이 필요한가?**
   - YES → 방식 B 추천
   - NO → 방식 A 추천

---

## 🎯 최종 권장사항

### 당신의 상황에서는 **방식 B (파트너스 전용)** 추천

**이유:**
1. 파트너스는 **판매자/파트너 관리** 시스템
2. 쇼핑은 **일반 사용자** 시스템
3. 역할과 권한이 **완전히 다름**
4. 향후 파트너스 특화 기능 추가 가능
5. 프로젝트 독립성 유지

---

## 📝 다음 단계

### 방식 B 선택 시
1. 쇼핑의 인증 파일 복사
2. 파트너스 전용 OAuth 클라이언트 생성
3. 파트너스 전용 환경 변수 설정
4. 필요시 파트너스 특화 기능 추가

### 방식 A 선택 시
1. 크로스 도메인 리다이렉트 구현
2. 쿠키 공유 설정
3. 토큰 검증 로직 구현
4. OAuth 제공자에 리다이렉트 URI 2개 등록

---

**당신의 선택을 알려주세요!** 🚀

